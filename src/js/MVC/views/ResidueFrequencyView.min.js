var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){a!=Array.prototype&&a!=Object.prototype&&(a[c]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,e={next:function(){if(d<a.length){var b=d++;return{value:c(b,a[b]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,c,d,e){if(c){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var b=a[e];b in d||(d[b]={});d=d[b]}a=a[a.length-1];e=d[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,d){return d})}},"es8","es3");
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var App=App||{},ResidueFrequencyView=function(){function a(a,d){function c(a,c){b.tip.show(a,c);a=b._calloutHeight;var f=b._calloutWidth,d=App.residueMappingUtility.getColor("Side Chain Class","family"),k=d3.scaleBand().rangeRound([0,f]).paddingInner(.05).align(.1),g=d3.scaleLinear().rangeRound([a,0]),e=d3.select("#"+b.semantic+"tipDiv svg").append("g").attr("transform","translate(40,10)"),h=b.frequencyRange[0]+c;h=b._model.getSequenceFrequenciesFromRange([h,h+1]);var l=[{column:c,data:h[0]}];k.domain(l.map(function(b){return b.column}));
g.domain([0,_.sum(_.values(h[0]))]).nice();c=g.ticks();var n=Math.ceil((c[1]-c[0])/2);c=_.toPairs(h[0]);c=_.filter(c,function(b){return b[1]>=n});c.sort(function(b,a){return a[1]-b[1]});h[0]=_.fromPairs(c.slice(0,5));var m=_.keys(h[0]);c=e.append("g").selectAll("g").data(d3.stack().keys(m)(h)).enter().append("g").attr("fill",function(b){return d(b.key).code});c.selectAll("rect").data(function(b){return b}).enter().append("rect").attr("x",function(b){return 10+k(l[0].column)}).attr("y",function(b){return g(b[1])}).attr("height",
function(b){return g(b[0])-g(b[1])}).attr("width",40);c.selectAll("text").data(function(b){return b}).enter().append("text").text(function(b,a,c){return m[c]}).attr("y",function(b){return g(b[1])+Math.round((g(b[0])-g(b[1]))/2)+3}).attr("x",function(b){return 60+k(l[0].column)}).style("font-size","10px").attr("text-anchor","middle").style("fill","#FFF");e.append("g").attr("class","axis").attr("transform","translate("+-f/2+","+a+")").call(d3.axisBottom(k));e.append("g").attr("class","axisPop").call(d3.axisLeft(g).ticks(null,
"s"));e.append("text").attr("transform","rotate(-90)").attr("y",-52.5).attr("x",0-a/2).attr("dy","1em").style("text-anchor","middle").style("fill","#FFF").text("Residue Count")}var b=this;b._model=a;b._id=d.id;b._dom=d3.select("#"+b._id);b._parent=d3.select("div."+d.parent);b._barOffset=10;b._familyMemberCount=d.rows;b._svg=null;b._visible=!1;b.frequencyRange=null;b._calloutWidth=125;b._calloutHeight=200;b._model.selectedProteinChanged.attach(function(a,c){b._visible&&(a=b._model.getSelectedResidues(d.semantic).selection,
b.update(c.selection.sequence.slice(a[0],a[1]),[a[0],a[1]]))});b._model.selectedResiduesChanged.attach(function(a,c){if(b._visible&&c.semantic===d.semantic){a=c.selection;c=b._model.getMaxSequenceFrequenciesFromRange(a);var f=b._model.getSelectedProtein();b.render({maxFrequencies:c,residues:f.sequence.slice(a[0],a[1]),brush_pos:a[0]*d.block_size+(a[1]*d.block_size-a[0]*d.block_size)/2,range:[a[0],a[1]]})}});b.set_scales=function(a,c){b.xScale=d3.scaleLinear().domain([0,a.length]).range(b.range);b.yScale=
d3.scaleLinear().domain([0,c]).range([b.bar_height,0])};b.render_bars=function(a,d){var e=b._svg.selectAll(".freq_bars").data(a);e.enter().append("g").append("rect").merge(e).attr("class",function(b,a){return"freq_bars r"+a}).attr("width",b.glyph_width).attr("height",b.bar_height).attr("y",function(a){return b.y_offset}).attr("x",function(a,c){return b.xScale(c)}).on("mouseover",c).on("mouseout",this.tip.hide).on("click",function(b,a,c){console.log(b)}).style("fill","white");e.exit().remove();a=b._svg.selectAll(".frequencies").data(a);
a.enter().append("rect").attr("class","frequencies").merge(a).attr("x",function(a,c){return b.xScale(c)}).attr("y",function(a){return b.yScale(a[1])+b.y_offset}).attr("width",b.glyph_width).attr("height",function(a){return b.bar_height-b.yScale(a[1])}).on("mouseover",c).on("mouseout",this.tip.hide).on("click",function(a,c,d){c=b._model.getSelectedProtein();App.textUtilities.occurrences(c.sequence.join(),a[0])}).attr("fill",function(b,a){return b[0]===d[a]?"#43a2ca":"#D3D3D3"});a.exit().remove()};
b.render_labels=function(a){a=b._svg.selectAll(".residueText").data(a);a.enter().append("text").attr("class","residueText").merge(a).attr("x",function(a,c){return b.xScale(c)+b.glyph_width/2}).attr("y",function(){return b.bar_height+b._barOffset+b.y_offset}).attr("dy",".35em").text(function(a){return a[0]}).style("text-anchor","middle").style("font-weight","bold").style("cursor","default").append("svg:title").text(function(a,b){return"Most frequent: "+a[0]+" \nOccurrences: "+a[1]});a.exit().remove()};
b.update=function(a,c){var d=b._svg.selectAll(".selectionText").data(a);d.enter().append("text").attr("class","selectionText").merge(d).attr("x",function(a,c){return b.xScale(c)+b.glyph_width/2}).attr("y",function(){return b.y_offset-b._barOffset}).attr("dy",".3em").text(function(a,b){return"("+(c[0]+b+1)+") "+a[0]}).style("text-anchor","middle").style("font-weight","bold").style("cursor","default").append("svg:title").text(function(a,b){return a[0]+" at position "+(c[0]+b+1)});d.exit().remove();
b._svg.selectAll(".frequencies").attr("fill",function(b,c){return b[0]===a[c]?"#D3D3D3":"#43a2ca"})};b.initialize(d)}a.prototype={initialize:function(a){var c=this;this._parent.classed("hidden",!1);this._parent.style("width",a.width).style("margin-left",a.margin).style("height",function(){return a.overviewImage?this.clientHeight:75});this.width=a.width/2;this.height=this._parent.node().clientHeight;this.aspectRatio=this.height/this.width;this.semantic=a.semantic;this.bar_height=.3*this.height;this.y_offset=
(this.height-this.bar_height+this._barOffset)/2;this.glyph_width=2*this.bar_height;this._dom.style("width",this.width).style("height",this.height);d3Utils.clear_chart_dom(this._dom);this._svg=d3Utils.create_chart_svg(this._dom,{width:this.width,height:this.height});this.tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"<div id='"+c.semantic+"tipDiv'><h5 style=' text-align: center; margin-top:0; font-weight: bold'>Most frequent</h5><svg class='barCallout' style='height:"+
(c._calloutHeight+15)+"px; width:"+c._calloutWidth+"px;'></svg></div>"});this._svg.call(this.tip);this.range=[a.offset_x,this.width];var e=d3.scaleLinear().domain([0,a.max_items]).range(this.range),b=this._barOffset/2,f=e(a.max_items-1);f+=.9*(e(a.max_items)-f);d3Utils.render_context_lines(this._svg,[[{x:this._barOffset,y:b},{x:f,y:b}],[{x:this._barOffset+1,y:b},{x:this._barOffset+1,y:b+this._barOffset}],[{x:f-1,y:b},{x:f-1,y:b+this._barOffset}]])},render:function(a){this.set_scales(a.maxFrequencies,
this._familyMemberCount,a.residues);this.range[0]=(this.width-this.xScale(a.residues.length-1))/2;this.xScale.range(this.range);this.frequencyRange=a.range;this.render_bars(a.maxFrequencies,this._familyMemberCount);this.render_labels(a.maxFrequencies);this.update(a.residues,a.range);d3Utils.render_context_bars(this._svg,{x:"left"===this.semantic?a.brush_pos:a.brush_pos-this.width,y:1,height:10,width:1});this._visible=!0}};return a}();
