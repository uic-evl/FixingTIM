var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,d,c){b!=Array.prototype&&b!=Object.prototype&&(b[d]=c.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(d){return $jscomp.SYMBOL_PREFIX+(d||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var d=0;return $jscomp.iteratorPrototype(function(){return d<b.length?{done:!1,value:b[d++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();var d=b[Symbol.iterator];return d?d.call(b):$jscomp.arrayIterator(b)};
$jscomp.polyfill=function(b,d,c,g){if(d){c=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var e=b[g];e in c||(c[e]={});c=c[e]}b=b[b.length-1];g=c[b];d=d(g);d!=g&&null!=d&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:d})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function d(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(f,b){f(a)})}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;d.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};d.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var g=$jscomp.global.setTimeout;d.prototype.asyncExecuteFunction=function(a){g(a,
0)};d.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var h=0;h<a.length;++h){var b=a[h];delete a[h];try{b()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};d.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var f=this.createResolveAndReject_();try{a(f.resolve,f.reject)}catch(k){f.reject(k)}};e.prototype.createResolveAndReject_=
function(){function a(a){return function(f){b||(b=!0,a.call(h,f))}}var h=this,b=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var f=null!=a;break a;case "function":f=!0;break a;default:f=!1}f?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var f=
void 0;try{f=a.then}catch(k){this.reject_(k);return}"function"==typeof f?this.settleSameAsThenable_(f,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var a=new d;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var f=this.createResolveAndReject_();try{a.call(b,f.resolve,f.reject)}catch(l){f.reject(l)}};e.prototype.then=function(a,b){function f(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(n){c(n)}}:b}var d,c,h=new e(function(a,
b){d=a;c=b});this.callWhenSettled_(f(a,d),f(b,c));return h};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(b,d){function f(){switch(c.state_){case 1:b(c.result_);break;case 2:d(c.result_);break;default:throw Error("Unexpected state: "+c.state_);}}var c=this;null==this.onSettledCallbacks_?a.asyncExecute(f):this.onSettledCallbacks_.push(function(){a.asyncExecute(f)})};e.resolve=c;e.reject=function(a){return new e(function(b,f){f(a)})};e.race=function(a){return new e(function(b,
f){for(var d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next())c(e.value).callWhenSettled_(b,f)})};e.all=function(a){var b=$jscomp.makeIterator(a),f=b.next();return f.done?c([]):new e(function(a,d){function e(b){return function(f){h[b]=f;g--;0==g&&a(h)}}var h=[],g=0;do h.push(void 0),g++,c(f.value).callWhenSettled_(e(h.length-1),d),f=b.next();while(!f.done)})};return e},"es6","es3");
$jscomp.iteratorFromArray=function(b,d){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,g={next:function(){if(c<b.length){var e=c++;return{value:d(e,b[e]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");
$jscomp.findInternal=function(b,d,c){b instanceof String&&(b=String(b));for(var g=b.length,e=0;e<g;e++){var a=b[e];if(d.call(c,a,e,b))return{i:e,v:a}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");
var App=App||{},ProteinFamilyView=function(){function b(b,c){function d(){var b=parseInt(window.getComputedStyle(a._dom.node())["margin-left"]);return{brushes:[{orientation:App.HORIZONTAL_PADDLE,paddleSize:1,class:"brush horizontal main",extent:[[0,a.y_offset],[a.width,a.height+a.y_offset+5]],block_size:a.residue_glyph_size,position:[a.y_offset,a.residue_glyph_size+a.y_offset],semantic:"horizontal",tooltip:function(b){return a._model.getSelectedProtein().name}},{orientation:App.VERTICAL_PADDLE,paddleSize:6,
maxPaddleSize:10,class:"brush vertical-left",extent:[[0,a.y_offset],[a.width,a.height+a.y_offset]],block_size:a.residue_glyph_size,semantic:"left",position:[0,6*a.residue_glyph_size+a.y_offset]},{orientation:App.VERTICAL_PADDLE,paddleSize:6,maxPaddleSize:10,class:"brush vertical-right",extent:[[0,a.y_offset],[a.width,a.height+a.y_offset]],block_size:a.residue_glyph_size,semantic:"right",position:[a.width-6*a.residue_glyph_size,a.width]}],frequencyViewers:[{id:"leftResidueSummaryViewer",parent:"residueSummaryView",
semantic:"left",max_items:10,block_size:a.residue_glyph_size,offset:a.y_offset,class:"center-align",margin:b,width:a.width,overview:a.overviewImage,offset_x:10},{id:"rightResidueSummaryViewer",parent:"residueSummaryView",semantic:"right",max_items:10,block_size:a.residue_glyph_size,offset:a.y_offset,class:"center-align",margin:b,width:a.width,overview:a.overviewImage,offset_x:10}]}}function e(b,d){var f=parseInt(window.getComputedStyle(a._dom.node())["margin-right"]);b=a._model.getProteinCount();
f=Math.round(a._dom.node().parentNode.clientWidth*a._overview_percentage)-f;var c=d/b;b=d3.scaleLinear().domain([0,b]).range([a.y_offset,d+a.y_offset]);a.brushPaddleSize=Math.floor(a.ppv*c);return{orientation:App.OVERVIEW_PADDLE,width:f,height:d,paddleSize:a.brushPaddleSize,maxPaddleSize:a.brushPaddleSize,scale:b,class:"brush horizontal overview",block_size:c,semantic:"family",extent:[[a.width+a.x_offset,a.y_offset],[a.width+a.x_offset+f,d+a.y_offset]],position:[a.y_offset,a.brushPaddleSize+a.y_offset],
proteinsPerView:a.ppv,parent:d3.select(a.brushSVG.node().parentNode)}}var a=this;a.initialized_promise=$.Deferred();a._model=b;a._id=c.id;a.overviewImage=!1;a._overview_percentage=.1;a._proteinCount=0;a._sequenceLength=0;a.glProgramInfo=null;a.gl=null;a.glBufferInfo=null;a.x_offset=0;a.y_offset=0;a._parentDom=d3.select("#"+a._id);a._container_width=d3.select("div.TrendImageView").node().clientWidth;a.spinnerDiv=null;a.fileUploaded=new EventNotification(this);a.fileUpdated=new EventNotification(this);
a.imageRendered=new EventNotification(this);a.overviewRendered=new EventNotification(this);a.render_overview=function(){return new Promise(function(b,d){d=parseInt(window.getComputedStyle(a._dom.node())["margin-right"]);var f=Math.round(a._dom.node().parentNode.clientWidth*a._overview_percentage)-d,c=new Image;c.onload=function(){a.canvasContext.drawImage(c,a.width+a.x_offset,a.y_offset,f,a.height);b()};c.src=a._backBufferImage})};a.initialize_back_buffer=function(b,d){return new Promise(function(c,
f){var e=[];b.forEach(function(b,c){b.forEach(function(b,c){c=a._model.getSequenceFrequencyAt(c);b=d(b,c).rgba;e.push(b[0],b[1],b[2],b[3])})});f=new Uint8Array(e);var h=a.gl.createTexture();a.gl.bindTexture(a.gl.TEXTURE_2D,h);a.gl.pixelStorei(a.gl.UNPACK_FLIP_Y_WEBGL,!0);a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_S,a.gl.CLAMP_TO_EDGE);a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_T,a.gl.CLAMP_TO_EDGE);a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MIN_FILTER,a.gl.NEAREST);a.gl.texImage2D(a.gl.TEXTURE_2D,
0,a.gl.RGBA,a._sequenceLength,a._proteinCount,0,a.gl.RGBA,a.gl.UNSIGNED_BYTE,f);twgl.setUniforms(a.glProgramInfo,{u_texture:h});twgl.drawBufferInfo(a.gl,a.gl.TRIANGLES,a.glBufferInfo);a._backBufferImage=a.backBufferCanvas.toDataURL();a._familyImage=new Image;a._familyImage.onload=function(){c(this)};a._familyImage.src=a._backBufferImage})};a.getXAxisScale=function(){return a.xScale};a.getYAxisScale=function(){return a.yScale};a.set_data_dimensions_sizes=function(b){a.x_axis_length=parseInt(_.max(d3.set(b.map(function(a){return a.length})).values()));
a.y_axis_length=this._model.getProteinNames().length};a.set_chart_dimensions=function(){var b=a._container_width,c=Math.floor(b/a.x_axis_length),d=c*a.x_axis_length;a._parentDom.classed("trend-viewer",!1).classed("proteinFamilyViewer",!0);var e=a.y_axis_length*c,g=a._parentDom.node().clientHeight,m=e/c;e<g?(a.height=e,a.width=b=d):e>g&&(a.overviewImage=!0,d+d*a._overview_percentage>b?(c=Math.floor((b-d*a._overview_percentage)/a.x_axis_length),a.width=c*a.x_axis_length):a.width=d,m=Math.round(g/c),
a.height=m*c);this.set_glyph_size(c);this.set_proteins_per_view(m);a._parentDom.classed("proteinFamilyViewer",!1);document.getElementById("trendImageViewer").parentNode.style.height=a.height+2*a.y_offset+2;document.getElementById("trendImageViewer").style.height=a.height+2*a.y_offset+2;document.getElementsByClassName("trendDiv")[0].style.height=a.height+2*a.y_offset+2;document.getElementById("trendImageViewer").style.width=Math.ceil(b).toString();document.getElementById("trendImageViewer").parentNode.style.width=
Math.ceil(b);document.getElementsByClassName("TrendImageView")[0].style.width=b};a.set_glyph_size=function(b){a.residue_glyph_size=b?b:Math.floor(a.width/a.x_axis_length);a.set_offsets(a.residue_glyph_size)};a.set_offsets=function(b){a.x_offset=6*b;a.y_offset=a.overviewImage?2*b:0};a.set_proteins_per_view=function(b){a.ppv=b?b:Math.floor(a.height/a.residue_glyph_size)};a.set_y_scale=function(b){a.yScale=d3.scaleBand().domain(b).range([a.y_offset,a.ppv*a.residue_glyph_size+a.y_offset])};a.set_chart_scales=
function(){a.xScale=d3.scaleLinear().domain([0,a.x_axis_length]).range([0,Math.ceil(a.width/a.residue_glyph_size)*a.residue_glyph_size]);a.set_y_scale(_.slice(a._model.getProteinNames(),0,a.ppv))};a.set_brush_SVG=function(b,c,d){return d3Utils.create_brush_svg(b,{width:c,height:d,y:a.y_offset}).append("g").attr("class","brushes").attr("width",c).attr("height",d).attr("x",0).attr("y",0)};a.initialize_file_open=function(b){b.classed("hidden",!1);var c=d3.select("#fileupload-open").node(),d=c.parentNode;
App.fileUtilities.familyUploadSetup(c,function(b,c){a.fileUpdated.notify({data:b,type:c})}).done(function(){c.style.width=d.clientWidth;c.style.height=d.clientHeight;c.style["z-index"]=11})};a._model.proteinFamilyAdded.attach(function(b,c){b=c.family;var f=App.residueMappingUtility.getColor(a._model.getProteinColoring(),"family"),g=a.initialize(c);(c=hopscotch.getState())&&0===c.indexOf("introduction_tour:")&&hopscotch.startTour(App.tour_family,1);a.initialize_back_buffer(b.data,f).then(a.render.bind(a,
a._familyImage,0,0)).then(function(){a.initialized_promise.resolve();a.imageRendered.notify(d());a.overviewImage&&a.render_overview().then(function(){a.overviewRendered.notify({brushSpec:e(g,a.height)});var b=[[{x:a.width+a.x_offset/2,y:0},{x:a.width+a.x_offset/2,y:a.height+2*a.y_offset}],[{x:a.width+a.x_offset/2-1,y:1},{x:a.width,y:1}],[{x:a.width+a.x_offset/2-1,y:a.height+2*a.y_offset-1},{x:a.width,y:a.height+2*a.y_offset-1}]];d3Utils.render_context_lines(d3.select(a.brushSVG.node().parentNode),
b);d3Utils.render_context_bars(d3.select(a.brushSVG.node().parentNode),{x:a.width+a.x_offset/4,y:a.brushPaddleSize/2,height:1,width:a.x_offset/2})});$("#coloring_list").find("li").removeClass("disabled");App.residueMappingUtility.createColorLegend("family")}).catch(console.log.bind(console))})}b.prototype={file_loaded:function(b,c){this._parentDom.select("#trendSplash").remove();this.fileUploaded.notify({data:b,type:c});return this.initialize_file_open(d3.select("#family_upload_li"))},show:function(){var b=
this;b._model.isEmpty()||$("#trendSplash").load("./src/html/familySplashTemplate.html",function(){var c=$(this);App.fileUtilities.familyUploadSetup(c.find("#fileupload-family"),b.file_loaded.bind(b))})},clear:function(){this._parentDom.selectAll("*").remove();this._parentDom.classed("trend-viewer",!0).classed("proteinFamilyViewer",!1);this._parentDom.node().removeAttribute("style");this._parentDom.node().parentNode.removeAttribute("style");document.getElementsByClassName("TrendImageView")[0].removeAttribute("style");
this.overviewImage=!1;$.contextMenu("destroy")},initialize:function(b){var c=b.family;this._proteinCount=b.proteinCount;this._sequenceLength=b.sequenceLength;this._dom=this._parentDom.append("div").classed("trendDiv",!0).classed("center-aligned",!0);this.set_data_dimensions_sizes(c.data);this.set_chart_dimensions();this.set_proteins_per_view();b=this.overviewImage?parseInt(1.1*this.width):this.width;this._dom.style("width",Math.ceil(b+this.x_offset)+1).style("height",this.height+2*this.y_offset);
this.canvasContext=d3Utils.create_chart_canvas(this._dom,{width:Math.ceil(b+this.x_offset)+1,height:this.height+2*this.y_offset,id:"trendCanvas",class:"trendImage"}).getContext("2d");this.canvasContext.imageSmoothingQuality="high";this.canvasContext.webkitImageSmoothingEnabled=!1;this.canvasContext.mozImageSmoothingEnabled=!1;this.canvasContext.imageSmoothingEnabled=!1;this.backBufferCanvas=d3Utils.create_chart_back_buffer({width:this._sequenceLength,height:this._proteinCount});this.gl=this.backBufferCanvas.getContext("webgl");
this.glProgramInfo=twgl.createProgramInfo(this.gl,["vs","fs"]);this.glBufferInfo=twgl.createBufferInfoFromArrays(this.gl,{position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]});this.gl.useProgram(this.glProgramInfo.program);twgl.setBuffersAndAttributes(this.gl,this.glProgramInfo,this.glBufferInfo);this.set_chart_scales();d3Utils.clear_chart_dom(this._dom);this.brushSVG=this.set_brush_SVG(this._dom,Math.ceil(b+this.x_offset)+1,this.height+2*this.y_offset);return b},render:function(b,c,g){var d=this;
return new Promise(function(a,e){d.canvasContext.drawImage(b,c,g/d.residue_glyph_size,d._model.getSequenceCount(),d.ppv,0,d.y_offset,d.width,d.height);a()})},reorder:function(b){var c=this;c.initialize_back_buffer(b.family.data,b.color).then(function(d){c.canvasContext.clearRect(0,c.y_offset,c.width,c.height);c.render(d,b.x,b.y).then(c.render_overview.bind(c)).then(function(){c.set_y_scale(_.slice(c._model.getProteinNames(),0,c.ppv))})})},recolor:function(b){var c=this;c.initialize_back_buffer(c._model.getFamily().data,
b.color).then(function(d){c.canvasContext.clearRect(0,c.y_offset,c.width,c.height);c.render(d,b.x,b.y).then(c.render_overview.bind(c))})},attachBrushes:function(b){var c=this;b.forEach(function(b){var d=b.getBrush();d=c.brushSVG.append("g").attr("class",b.brushObj.getBrushClass).call(d).call(d.move,b.getInitialPosition());b.render(d)})},getPromise:function(){return this.initialized_promise.promise()},getGlyphSize:function(){return this.residue_glyph_size},getWidth:function(){return this.width},getXOffset:function(){return this.x_offset},
getXDimensionSize:function(){return this.x_axis_length},getYDimensionSize:function(){return this.y_axis_length}};return b}();
