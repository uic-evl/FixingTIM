var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,e,d){a instanceof String&&(a=String(a));for(var f=a.length,c=0;c<f;c++){var g=a[c];if(e.call(d,g,c,a))return{i:c,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,d){a!=Array.prototype&&a!=Object.prototype&&(a[e]=d.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,e,d,f){if(e){d=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var c=a[f];c in d||(d[c]={});d=d[c]}a=a[a.length-1];f=d[a];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
var App=App||{},TertiaryStructureView=function(){function a(c){var g=App.residueMappingUtility.getColor(c,"3D");return new pv.color.ColorOp(function(c,b,a){c=g(c._residue._name).rgba;b[a+0]=c[0]/255;b[a+1]=c[1]/255;b[a+2]=c[2]/255;b[a+3]=c[3]/255})}function e(c,a){d3.select(c).select("#proteinName p").text(_.toUpper(a))}function d(c,a){a.selection?this.picked.node().setSelection(a.selection):(c=this.selectResidue(this._model.getGeometry().selection(),a.residue),this._model.getGeometry().setSelection(c));
this.pvViewer.requestRedraw()}function f(c,a){function g(){hopscotch.startTour(App.tour_3D,1);console.log("help")}var b=this;b._model=c;b._id=a.id;b._position=a.position;b._dom=null;b.pvViewer=null;b.axis3D=null;b.splash=null;b.staticLabel="";b.fileUploaded=new EventNotification(this);b.fileUpdated=new EventNotification(this);b.residueSelected=new EventNotification(this);b.residueDeselected=new EventNotification(this);b.colorChanged=new EventNotification(this);b.modelRotated=new EventNotification(this);
b.modelZoomed=new EventNotification(this);b.cameraChanged=new EventNotification(this);b.clear_splash=function(){b.splash.find("#files").empty();b.splash.find("#protein-name").val("");b.splash.find("#fileUploadInput").val("")};b.clear_and_reinitialize=function(){b._model.isEmpty()||b.initialize_file_update(d3.select(b._dom[0]).select("#proteinName"));b.clear_splash()};b.initialize_file_update=function(c){c.classed("hidden",!1).select(".settingsOpenPDB").classed("hidden",!1);$(c.node()).click(function(){b._dom.find("#pvDiv").find(".tertiaryViewer, .axisViewer, .static-label").hide();
b._dom.find("#splashOverlay").addClass("open");b._dom.find(".x_title").hide();b.splash.show()});b._dom.find("#overlayBackground, #overlayClose").click(function(){b.clear_splash();b.splash.hide();b._dom.find(".x_title").show();b._dom.find(".tertiaryViewer, .axisViewer, .static-label").show()});b.splash.find("#fileUploadInput").fileupload("destroy");b.splash.find("#fileUploadInput").unbind("fileuploadadd");App.fileUtilities.uploadSetup(b.splash.find("#fileUploadInput"),b.splash.find("#files"),function(c,
a){b.fileUpdated.notify({metaData:c,file:a});b.clear_splash();e(b._dom[0],c.protein_name)})};b.initialize_menus=function(){$.get("./src/html/proteinGeometryListTemplate.html",function(c){b._dom.find("#geometry_list a").after(c);c=new FilteringMenuModel({items:"cartoon tube trace sline lines lineTrace spheres points".split(" ")});var a=new FilteringMenuView(c,{list:b._dom.find("#geometry_ul")});new FilteringMenuController({menu:"geometry",models:{list:c,connected:[b._model]},view:a,cb:function(c,a){b.pvViewer.rm(c.getName());
b.render(c.getStructure(),c.getName(),a);b.pvViewer.requestRedraw()}});a.show()});$.get("./src/html/proteinColoringListTemplate.html",function(c){b._dom.find("#protein_coloring_list a").after(c);c=new FilteringMenuModel({items:["Side Chain Class","Side Chain Polarity","Selections Only"]});var a=new FilteringMenuView(c,{list:b._dom.find("#protein_coloring_ul")});new FilteringMenuController({menu:"coloring",models:{list:c,connected:[b._model]},view:a,cb:function(c,a){b.recolor(a);b.colorChanged.notify({color:a});
App.residueMappingUtility.createColorLegend("3D")}});a.show()});d3.select(b._dom[0]).select("#molecularViewerMenu").classed("hidden",!1);$("#"+b._id+" #molecularViewerHelp").click(g)};b._model.proteinAdded.attach(function(c,a){$("#"+b._id).find("#popup-trigger-molecule").remove();b.splash.hide();b.initialize();b.render(a.structure,a.name,"tube");b._dom.find(".x_title").show();b.pvViewer.centerOn(a.structure);b.pvViewer.autoZoom();$("#coloring_list").find("li").removeClass("disabled");App.residueMappingUtility.createColorLegend("3D");
(c=hopscotch.getState())&&0===c.indexOf("introduction_tour:")&&hopscotch.startTour(App.tour_3D,1)});b._model.proteinColoringChanged.attach(function(c,a){b.recolor(a.scheme);b.pvViewer.requestRedraw()});b._model.residueSelected.attach(d.bind(b));b._model.residueDeselected.attach(d.bind(b));b._model.rotateModel.attach(function(c,a){b.pvViewer._redrawRequested=!1;b.pvViewer.setRotation(a.rotation)});b._model.zoomModel.attach(function(c,a){b.pvViewer._cam._zoom!==a.zoom&&(b.pvViewer.setZoom(a.zoom),b.pvViewer._draw())});
b._model.cameraChanged.attach(function(c,a){b.pvViewer._redrawRequested=!1;b.pvViewer.setCamera(a.rotation,a.center,a.zoom)});_.mixin(b,new pvUtils(b))}f.prototype={file_loaded:function(c,a){this.fileUploaded.notify({metaData:c,file:a});e(this._dom[0],c.protein_name);this.clear_and_reinitialize()},show:function(){var c=this;c._dom=$("#"+c._id);c._model.isEmpty()||this._dom.find("#splash").load("./src/html/tertiarySplashTemplate.html",function(){var a=$(this),d=a.find("#popup-trigger-molecule");d.click(function(){a.find("#splashOverlay").addClass("open").find(".signup-form input:first").select();
d.hide()});a.find("#overlayBackground, #overlayClose").click(function(){a.find("#splashOverlay").removeClass("open");d[0]&&d.show()});c.splash=a;ko.applyBindings(c,a.find("#splashTemplate")[0]);App.fileUtilities.uploadSetup(a.find("#fileUploadInput"),a.find("#files"),c.file_loaded.bind(c))})},clear:function(){this._dom.find("#pvView *:not(#splash*)").remove();this.axis3D=this.pvViewer=null},downloadPDB:function(c){c="object"===typeof c?$(c).serialize().split("=")[1]:c;this.fileUploaded.notify({metaData:{protein_name:c},
file:null});this.clear_and_reinitialize();e(this._dom[0],c);return!1},initialize:function(){var c=this._dom.find("#pvDiv"),a=c[0];this.staticLabel=document.createElement("div");this.staticLabel.innerHTML="&nbsp;";this.staticLabel.className="static-label";a.appendChild(this.staticLabel);var d={antialias:!0,outline:!1,quality:"low",near:.1,background:"black",width:parseInt(d3.select(a).style("width")),height:parseInt(d3.select(a).style("height")),selectionColor:"#984ea3"};this.pvViewer=pv.Viewer(a,
d);this.linkInteractions();c.find("canvas").addClass("tertiaryViewer");a.addEventListener("mousemove",this.mouseMoveEvent);this.pvViewer.on("click",this.mouseClickEvent);c=document.createElement("div");var b=d.width/4;d=d.height/4;c.className="axisViewer";c.style.height=d;c.style.width=b;a.append(c);this.axis3D=new AxisView3D({div:c,width:b,height:d});this.initialize_menus()},render:function(c,d,e){c=this.pvViewer.renderAs(d,c,e,{color:a.call(this,this._model.getProteinColoring())});this._model.setGeometry(c)},
recolor:function(c){var d=this._model.getGeometry(),e=this.pvViewer;d&&(d.colorBy(a.call(this,c)),e.requestRedraw())}};return f}();
