var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,g,e){a!=Array.prototype&&a!=Object.prototype&&(a[g]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(g){return $jscomp.SYMBOL_PREFIX+(g||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var g=0;return $jscomp.iteratorPrototype(function(){return g<a.length?{done:!1,value:a[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,g){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var e=0,f={next:function(){if(e<a.length){var h=e++;return{value:g(h,a[h]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill=function(a,g,e,f){if(g){e=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var h=a[f];h in e||(e[h]={});e=e[h]}a=a[a.length-1];f=e[a];g=g(f);g!=f&&null!=g&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,e){return e})}},"es8","es3");
var App=App||{},ProteinFamilyController=function(){function a(a,e){function g(a){var d=a.brushSpec.scale,c=new BrushView(b._model,a.brushSpec);c.brushMoved.attach(function(k,c){k=c.selection.map(d.invert);k[0]=Math.round(k[0]);k[1]=Math.round(k[1]);c=c.selection[0]+(c.selection[1]-c.selection[0])/2;d3Utils.render_context_bars(a.brushSpec.parent,{x:b._view.getWidth()+b._view.getXOffset()/4,y:c,height:1,width:b._view.getXOffset()/2});b._view.render(b._view._familyImage,0,k[0]*b._view.getGlyphSize());
b._model.setOverviewOffset(k[0])});return b._brushViews.overview=c}function h(a){a.forEach(function(a){var c=new BrushView(b._model,a);a.orientation===App.HORIZONTAL_PADDLE&&c.proteinSelected.attach(function(a,c){b.proteinSelected.notify(c)});c.brushMoved.attach(function(a,c){a=c.options;if(a.orientation===App.HORIZONTAL_PADDLE)a=c.selection,a=parseInt((a[0]+a[1])/2),a=b._view.getYAxisScale().invert(a),b._model.setSelectedProtein(a);else if(a.orientation===App.VERTICAL_PADDLE){c=c.selection.map(b._view.getXAxisScale().invert);
c[0]=parseInt(Math.round(c[0]));c[1]=parseInt(Math.round(c[1]));var d=b._model.getSelectedResidues(a.semantic).selection;d[0]===c[0]&&d[1]===c[1]||b._model.setSelectedResidues(a.semantic,c)}});b._brushViews[a.semantic]=c})}function m(a){$("#residueSummaryView").load("./src/html/frequencyViewerTemplate.html",function(){var c=b._view.getYDimensionSize(),g=b._model.getSelectedProtein();a.forEach(function(a){var d=new ResidueFrequencyView(b._model,_.assign(a,{rows:c}));b._frequencyViews[a.semantic]=d;
var e=b._brushViews[a.semantic].getInitialPosition(),f=_.map(e,function(b){return parseInt(b/a.block_size)}),h=b._model.getMaxSequenceFrequenciesFromRange(f);b._model.getSequenceFrequenciesFromRange(f);b._model.setSelectedResidues(a.semantic,f);d.render({maxFrequencies:h,residues:g.sequence.slice(f[0],f[1]),brush_pos:e[0]+(e[1]-e[0])/2,range:[f[0],f[1]]})})})}function l(){var a=b._brushViews.overview.getSelection(),d=b._brushViews.overview.getScale();a=a.map(d.invert);a[0]=Math.round(a[0]);a[1]=Math.round(a[1]);
return a}var b=this;b._model=a;b._view=e;b._brushViews={};b._frequencyViews={};b.proteinSelected=new EventNotification(this);$("#familyHelp").click(function(){hopscotch.startTour(App.tour_family,1)});b._model.proteinColoringChanged.attach(function(a,d){b._model.isEmpty()&&(a=App.residueMappingUtility.getColor(d.scheme,"family"),d=[0,0],b._brushViews.overview&&(d=l()),b._view.recolor({color:a,x:0,y:d[0]*b._view.getGlyphSize()}))});b._model.proteinSortingChanged.attach(function(a,d){a=d.data;d=App.residueMappingUtility.getColor(d.colorScheme,
"family");var c=[0,0];b._brushViews.overview&&(c=l());b._view.reorder({family:a,color:d,x:0,y:c[0]*b._view.getGlyphSize()})});b._view.fileUploaded.attach(function(a,b){a._model.setFamily(b.data,b.type)});b._view.fileUpdated.attach(function(a,d){b._model.clear();b._view.clear();d3.select("#residueSummaryView").selectAll("*").remove();d3.selectAll(".d3-tip").remove();b._brushViews.horizontal.removeContextMenu();delete b._brushViews;delete b._frequencyViews;b._frequencyViews={};b._brushViews={};a._model.setFamily(d.data,
d.type)});b._view.imageRendered.attach(function(a,d){h(d.brushes);m(d.frequencyViewers);b._view.attachBrushes(_.values(b._brushViews))});b._view.overviewRendered.attach(function(a,d){b._view.attachBrushes([g(d)])})}a.prototype={};return a}();
