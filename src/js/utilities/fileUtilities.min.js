var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){a!=Array.prototype&&a!=Object.prototype&&(a[c]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,g={next:function(){if(d<a.length){var f=d++;return{value:c(f,a[f]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill=function(a,c,d,g){if(c){d=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var f=a[g];f in d||(d[f]={});d=d[f]}a=a[a.length-1];g=d[a];c=c(g);c!=g&&null!=c&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,d){return d})}},"es8","es3");
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.checkStringArgs=function(a,c,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var g="";a;)if(a&1&&(g+=c),a>>>=1)c+=c;return g}},"es6","es3");$jscomp.stringPadding=function(a,c){a=void 0!==a?String(a):" ";return 0<c&&a?a.repeat(Math.ceil(c/a.length)).substring(0,c):""};
$jscomp.polyfill("String.prototype.padEnd",function(a){return a?a:function(a,d){var c=$jscomp.checkStringArgs(this,null,"padStart");return c+$jscomp.stringPadding(d,a-c.length)}},"es8","es3");$jscomp.findInternal=function(a,c,d){a instanceof String&&(a=String(a));for(var g=a.length,f=0;f<g;f++){var h=a[f];if(c.call(d,h,f,a))return{i:f,v:h}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var c=a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function c(){this.batch_=null}function d(a){return a instanceof f?a:new f(function(k,e){k(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;c.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};c.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var g=$jscomp.global.setTimeout;c.prototype.asyncExecuteFunction=function(a){g(a,
0)};c.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var e=a[b];delete a[b];try{e()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};c.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(e){b.reject(e)}};f.prototype.createResolveAndReject_=
function(){function a(a){return function(k){e||(e=!0,a.call(b,k))}}var b=this,e=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(e){this.reject_(e);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var h=new c;f.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};f.prototype.settleSameAsThenable_=function(a,b){var e=this.createResolveAndReject_();try{a.call(b,e.resolve,e.reject)}catch(l){e.reject(l)}};f.prototype.then=function(a,b){function e(a,b){return"function"==typeof a?function(b){try{c(a(b))}catch(m){k(m)}}:b}var c,k,h=new f(function(a,
b){c=a;k=b});this.callWhenSettled_(e(a,c),e(b,k));return h};f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,b){function e(){switch(c.state_){case 1:a(c.result_);break;case 2:b(c.result_);break;default:throw Error("Unexpected state: "+c.state_);}}var c=this;null==this.onSettledCallbacks_?h.asyncExecute(e):this.onSettledCallbacks_.push(function(){h.asyncExecute(e)})};f.resolve=d;f.reject=function(a){return new f(function(b,e){e(a)})};f.race=function(a){return new f(function(b,
e){for(var c=$jscomp.makeIterator(a),h=c.next();!h.done;h=c.next())d(h.value).callWhenSettled_(b,e)})};f.all=function(a){var b=$jscomp.makeIterator(a),e=b.next();return e.done?d([]):new f(function(a,c){function h(b){return function(e){f[b]=e;k--;0==k&&a(f)}}var f=[],k=0;do f.push(void 0),k++,d(e.value).callWhenSettled_(h(f.length-1),c),e=b.next();while(!e.done)})};return f},"es6","es3");
var App=App||{},FileUtilities=function(){function a(a,c){$.ajax({type:"HEAD",url:a}).done(function(){c(a)})}function c(a){a=_.values(a);a.forEach(function(a){a.sequence=a.sequence.split("")});return a}function d(a){var f=a.split("\n"),b={},e=0,h=!1;f.forEach(function(a,c){if(a.length){var k=/(\w+\|?\w*?)\/(\d*)-(\d*)\s*([~.\w\s]*)/,d=a.match(/Name:\s*(\w+\|?\w*?)\/(\d+)-(\d+)\s*Len:\s*(\d+)\s*Check:\s*(\d+)\s*Weight:\s*(\d*\.?\d*)/);if(d)if(b[d[1]]={name:d[1],firstResiduePosition:parseInt(d[2]),lastResiduePosition:parseInt(d[3]),
length:parseInt(d[4]),check:parseInt(d[5]),weight:parseInt(d[6]),sequence:"",scores:{initial:f.length-c}},0===e)e=b[d[1]].length;else{if(b[d[1]].length>e||b[d[1]].length<e)h=!0,e=Math.max(e,b[d[1]].length)}else k.test(a)&&(d=a.match(k),b[d[1]].sequence+=_.toUpper(d[4].split(" ").join("")))}});h&&Object.keys(b).forEach(function(a){b[a].sequence=_.padEnd(b[a].sequence,e,".");b[a].length=e});return c(b)}function g(a){var f=a.split(">"),b={},e=0,d=!1;f.forEach(function(a,c){if(a.length){(a=a.match(/((\w*)\/?\d*-?\d*)\s*(\S*)/))&&
(b[a[1]]={name:a[2],full_name:a[1],length:a[3].length,sequence:_.toUpper(a[3]),scores:{initial:f.length-c}});if(0===e)e=b[a[1]].length;else if(b[a[1]].length>e||b[a[1]].length<e)d=!0,e=Math.max(e,b[a[1]].length);d&&Object.keys(b).forEach(function(a){b[a].sequence=_.padEnd(b[a].sequence,e,".");b[a].length=e})}});return c(b)}function f(a,c){var b=a.find("#files");return $(a).find("#fileUploadInput").fileupload({url:"",dataType:"json",autoUpload:!1}).on("fileuploadadd",function(e,d){var h=$(this).prop("disabled",
!0),k=d.files.pop();d.context=$("<div/>").appendTo(b);e=$("<p/>").append($("<span/>").text(k.name));a.find("#next").on("click",function(){var a=new FileReader,b=k.name.split(".")[0],e=k.name.split(".").pop().toLowerCase();a.addEventListener("load",function(){c({protein_name:b,extension:e},this.result)},!1);a.readAsText(k);d.abort();h.prop("disabled",!1)});var g=$("<button/>").addClass("btn btn-primary uploadPDB").text("Cancel").on("click",function(){var b=$(this),e=b.data();a.find("#fileUploadInput").fileupload("destroy");
a.find("#fileUploadInput").unbind("fileuploadadd");a.find("#next").unbind("click");f(a,c);b.parent().remove();e.abort();h.prop("disabled",!1)});e.appendTo(d.context).append(g.clone(!0).data(d))}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled").promise()}return{parseAlignmentFile:function(a,c){switch(c){case "fa":return g(a);case "msf":return d(a)}},uploadPDB:function(a,c){return new Promise(function(b,e){c.structure=pv.io.pdb(a,{loadAllModels:!0})[0];
b(c.structure)})},ajaxFromRCMB:function(c,d){a("http://files.rcsb.org/download/"+c+".pdb",function(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){4===b.readyState&&200===b.status&&d(this.response)};b.responseType="blob";b.open("GET","http://files.rcsb.org/download/"+c+".pdb");b.send()})},downloadFromRCMB:function(a,c){return new Promise(function(b,e){pv.io.fetchPdb("http://files.rcsb.org/download/"+a+".pdb",function(a){c.structure=a;b(c.structure)})})},uploadSetup:function(a,c,b){return $(a).fileupload({url:"",
dataType:"json",autoUpload:!1}).on("fileuploadadd",function(a,d){var e=$(this).prop("disabled",!0),f=d.files[0];d.context=$("<div/>").appendTo(c);a=$("<p/>").append($("<span/>").text(f.name));var g=$("<button/>").addClass("btn btn-primary uploadPDB").text("Upload").on("click",function(){var a=new FileReader,c=f.name.split(".")[0],g=f.name.split(".").pop().toLowerCase();a.addEventListener("load",function(){b({protein_name:c,extension:g},this.result)},!1);a.readAsText(f);$(this).parent().remove();d.abort();
e.prop("disabled",!1)}),h=$("<button/>").addClass("btn btn-primary uploadPDB").text("Cancel").on("click",function(){var a=$(this),b=a.data();a.parent().remove();b.abort();e.prop("disabled",!1)});a.appendTo(d.context).append(g.clone(!0).data(d)).append(h.clone(!0).data(d))}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled").promise()},familyUploadSetup:function(a,c){return $(a).fileupload({url:"",dataType:"json",autoUpload:!1}).on("fileuploadadd",function(a,
d){a=d.files[0];var b=a.name.split(".").pop().toLowerCase(),e=new FileReader;e.addEventListener("load",function(){c(this.result,b)},!1);e.readAsText(a);d.abort()}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled").promise()},initialUploadSetup:f}};App.fileUtilities=new FileUtilities;
